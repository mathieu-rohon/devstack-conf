#!/bin/bash

set -x

source openrc admin demo

FIXED_RANGE=20.0.0.0/24
NETWORK_GATEWAY=20.0.0.1

TENANT_ID=$(openstack project list | grep " demo " | get_field 1)
NET_ID=$(neutron net-create "$PRIVATE_NETWORK_NAME" | grep ' id ' | get_field 2)
neutron subnet-create --gateway $NETWORK_GATEWAY $NET_ID $FIXED_RANGE

BGPVPN_ID=$(neutron bgpvpn-create --route-targets 64512:1 | grep -m 1 'id' | get_field 2)
neutron bgpvpn-net-assoc-create --network $NET_ID $BGPVPN_ID

neutron-debug --config-file /etc/neutron/l3_agent.ini probe-create $NET_ID
PROBE_NETNS=$(ip netns show | grep probe)

sudo ip netns exec $PROBE_NETNS ip r add default via $NETWORK_GATEWAY

